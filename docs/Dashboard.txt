Tela: Dashboards de Estoque
===========================

Visao geral
-----------
- Consolida indicadores de movimentacao de estoque (entradas, saidas, valor total, alertas) no periodo filtrado.
- Grupos por periodo (mes/ano) e rankings (materiais, categorias, fabricantes, centros, setores, pessoas).
- Fonte: `api.estoque.dashboard` via `fetchDashboardEstoque` (`src/services/dashboardEstoqueApi.js`).

Arquitetura
-----------
- Hook `useDashboardEstoque` concentra filtros, cacheia a chave de busca para evitar recargas repetidas e monta series/ rankings; utils em `src/utils/dashboardEstoqueUtils.js`.
- `DashboardEstoqueProvider` expõe estado e mensagens de tooltip; pagina `DashboardPage.jsx` so orquestra filtros, cards e grade de graficos.
- Sem spinner global: botao de filtro permanece estatico; dados so atualizam quando a chave de filtros muda.

Filtros disponiveis
-------------------
- Periodo inicial/final (AAAA-MM) e termo livre (nome/fabricante/categoria/centro/setor/pessoa).
- Clique em graficos aplica filtro contextual (`chartFilter`) e exibe badge "Limpar".
- **Aplicar filtros** chama `load(filters)`; **Limpar filtros** restaura o ano corrente.

Indicadores principais
----------------------
- Cards de resumo (movimentacoes, valor movimentado, estoque/saidas, alertas ativos, materiais monitorados) com variantes de cor (`tone`) definidas em `highlightCards`.
- Serie historica (EntradasSaidasChart) agrega quantidades/valores por mes via `agruparPorPeriodo`.
- Valor movimentado (ValorMovimentadoChart) usa a mesma serie com formatacao BRL.
- Rankings: materiais, categorias, fabricantes, centros, setores e pessoas construidos pelas funcoes `montarTop*` dos utils (filtros aplicados localmente).

Erros e comportamento
---------------------
- Erros de carga sao reportados via `useErrorLogger('dashboard_estoque')`; pagina exibe mensagem de erro ao inves de flicker.
- Modal de expansao nos graficos usa `expandedChartId`; clique fora ou no X fecha.

Boas praticas para dados
------------------------
- Retorne `valorUnitario` nas entradas/saidas para que os valores financeiros sejam corretos.
- Mantenha campos de exibicao preenchidos (fabricante, centro de servico, setor, pessoa) para evitar rótulos "Nao informado".
- No modo local, mantenha o formato da resposta de `api.estoque.dashboard` alinhado aos utils para evitar ajustes na pagina.

Atualizacao 2025-12
-------------------
- Refatorado para hook/context e utils dedicados; cache da chave de filtros remove recargas desnecessarias e flicker nos botoes.
- Filtros clicaveis centralizados no hook; pagina apenas cola componentes.
