Tela: Materiais
===============

Visão geral
-----------
- Cadastro completo de EPIs com suporte a grupos, numeração específica, histórico de valores e filtros por status.
- Componentes dedicados encapsulam formulário, filtros, tabela e modal de histórico.
- Opera com os mesmos comportamentos tanto no modo Supabase quanto no modo local.

Fluxo principal
---------------
1. `MateriaisPage` carrega a lista de materiais (`dataClient.materiais.list`) e os grupos disponíveis (`dataClient.materiais.groups`) logo após montar.
2. O formulário utiliza `validateMaterialForm` e `createMaterialPayload`/`updateMaterialPayload` para normalizar e validar os campos antes de salvar.
3. Criação e edição chamam `dataClient.materiais.create` ou `.update`, adicionando `usuarioResponsavel` com base no `AuthContext`.
4. O modal de histórico (`MateriaisHistoryModal`) busca os registros sob demanda com `dataClient.materiais.priceHistory(materialId)` e mantém cache em memória.

Campos e regras principais
--------------------------
- `nome` e `fabricante`: obrigatórios, sem números no nome (regra aplicada em `validateMaterialForm`).
- `validadeDias`: inteiro > 0.
- `ca`: dígitos apenas (`sanitizeDigits`).
- `valorUnitario`: monetário com formatação amigável (`formatCurrencyInput`).
- `estoqueMinimo`: inteiro ≥ 0 (pode ficar em branco para considerar 0).
- `grupoMaterial`: obrigatório; ao mudar, reinicia campos dependentes (`numeroCalcado`, `numeroVestimenta`).
- `numeroCalcado`: obrigatório apenas para grupos identificados como calçados.
- `numeroVestimenta`: obrigatório apenas para grupos classificados como vestimenta.
- `descricao` e `ativo`: opcionais (toggle na tabela).
- `numeroEspecifico`/`chaveUnica`: calculados pelo backend para garantir unicidade por grupo + número.

Filtros e tabela
----------------
- Filtros por termo (nome/fabricante), status (`ativo`) e grupo.
- `filterMateriais` aplica a filtragem no cliente; a ordenação padrão utiliza `sortMateriaisByNome`.
- Tabela mostra valores formatados (`formatCurrency`) e realça materiais inativos.
- Ações por linha: editar (preenche o formulário) e histórico de preços.

Histórico de preços
-------------------
- `MateriaisHistoryModal` exibe cada alteração de `valorUnitario` com data/hora, valor anterior e usuário responsável.
- O backend registra entradas na tabela `material_price_history` sempre que o valor muda (`src/services/api.js`).

Componentes e arquivos relevantes
---------------------------------
- `src/pages/Materiais.jsx`
- `src/components/Materiais/MateriaisForm.jsx`
- `src/components/Materiais/MateriaisFilters.jsx`
- `src/components/Materiais/MateriaisTable.jsx`
- `src/components/Materiais/MateriaisHistoryModal.jsx`
- `src/rules/MateriaisRules.js`
- `src/utils/MateriaisUtils.js`

Integração com outros módulos
-----------------------------
- Materiais são usados por Entradas, Saídas, Estoque e Termo de EPI.
- A edição de estoque mínimo reflete imediatamente na tela de Estoque (`docs/Estoque.txt`).
- Os grupos retornados aqui alimentam formulários e filtros nos módulos de movimentação.
