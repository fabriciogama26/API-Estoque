Guia: alternar modo local e Supabase
===================================

Resumo
------
O frontend pode operar com duas origens de dados: Supabase (remoto) ou armazenamento local (`localStorage`). Este guia mostra como alternar entre os modos sem inconsistências.

Como funciona
-------------
- `VITE_DATA_MODE` controla o modo. Qualquer valor diferente de `local` ativa o modo remoto.
- `src/config/runtime.js` expõe `dataMode`, `isLocalMode` e `isRemoteMode`. `dataClient` escolhe entre `src/services/api.js` (Supabase) e `src/services/localApi.js` com base nessas flags.【F:src/config/runtime.js†L1-L12】【F:src/services/dataClient.js†L1-L6】
- No modo local, os dados são persistidos no `localStorage` com chave `api-estoque-local-data-v1`. Seeds iniciais ficam em `src/data/local-seed.json` e são carregados por `localDataStore` quando não há dados prévios.【F:src/config/runtime.js†L6-L12】【F:src/services/localApi.js†L1-L120】

Alternando para modo local
--------------------------
1. Crie/edite `.env.local` com `VITE_DATA_MODE=local`.
2. (Opcional) Configure `VITE_LOCAL_USERNAME`, `VITE_LOCAL_PASSWORD`, `VITE_LOCAL_DISPLAY_NAME` para personalizar o login offline.【F:src/context/AuthContext.jsx†L7-L84】
3. Execute `npm run dev`. No login use as credenciais locais e confirme o badge “Dados locais” no componente `SystemStatus` (sidebar).
4. Para reiniciar os dados, limpe o `localStorage` (chave `api-estoque-local-data-v1`) ou apague manualmente em `Application Storage` do navegador.

Alternando para modo Supabase
-----------------------------
1. Remova ou defina `VITE_DATA_MODE=remote` no `.env.local`.
2. Informe `VITE_SUPABASE_URL` e `VITE_SUPABASE_ANON_KEY` (e demais variáveis necessárias: `VITE_SUPABASE_PASSWORD_REDIRECT`, `VITE_SUPABASE_FUNCTIONS_URL`, etc.).
3. Garanta que o usuário exista no Supabase Auth e tenha permissão RLS adequada.
4. Reinicie o Vite (`npm run dev`) e faça login com o e-mail cadastrado no Supabase. O badge do `SystemStatus` deve indicar “Supabase”.

Cuidados ao alternar
--------------------
- Mudanças no modo não migram dados automaticamente. Registros criados offline permanecem no navegador.
- Verifique se chaves de cache (`api-estoque-auth`, `api-estoque-local-data-v1`) não conflitam entre ambientes. Limpe-as ao alternar para evitar dados inconsistentes.
- Alguns recursos dependem exclusivamente do Supabase (ex.: dashboard de acidentes remoto, geração de PDF). No modo local esses recursos podem mostrar mensagem de indisponibilidade.【F:src/pages/DashboardAcidentes.jsx†L60-L118】【F:src/utils/TermoEpiUtils.js†L1-L94】


Atualizacao 2025-11
--------------------
- Adicionei orientacao para garantir que os datasets locais contenham `fabricanteNome` e `centroServico` legiveis, evitando exibicao de UUIDs nos graficos interativos durante o desenvolvimento offline.
- Reforcei que o seed agora precisa incluir valores coerentes para que o novo filtro acionado pelos graficos produza resultados visiveis no modo local.
