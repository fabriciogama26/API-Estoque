Tela: Autenticacao (Login e Reset de Senha)

Visao geral

Login com Supabase Auth no modo remoto e modo local (credenciais via .env.local) para desenvolvimento offline. Recuperacao de senha via email e pagina de redefinicao com validacao do link.

Arquitetura (modular)

- Hooks: useLoginForm (estado, submit, recuperacao), useResetPassword (restaura sessao do link, valida senhas, envia update).
- Servicos: authService (resetPasswordForEmail, updateUser, restoreResetSession) usando supabaseClient; errorLogService registra falhas em app_errors.
- Contexto: AuthContext fornece user, login, recoverPassword, logout; suporta persistSession e autoRefresh.

Fluxos

- Login: email + senha; em modo local compara com VITE_LOCAL_USERNAME/PASSWORD; em modo remoto usa supabase.auth.signInWithPassword.
- Recuperacao: envia resetPasswordForEmail com redirect configuravel; feedback de sucesso/erro.
- ResetPasswordPage: valida sessao via getSession/getSessionFromUrl/exchangeCodeForSession/setSession; exige senha >=8 e confirmacao; redireciona ao login apos sucesso.

Boas praticas

- Manter variaveis VITE_SUPABASE_URL/ANON_KEY configuradas; usar redirectTo para reset se necessario.
- Registrar erros (login, recovery, updatePassword, restoreResetSession) em app_errors para auditoria.

Atualizacao 2025-12

- Telas modularizadas com hooks/services e logging; compatibilidade com modo local preservada.

===========================================
Mapa de Codigo (funcoes, hooks e constantes)
===========================================

Funcoes principais
------------------
- LoginPage
  - Tipo: componente de pagina React
  - Caminho: src/pages/LoginPage.jsx
  - Responsavel por: UI de login, aciona o hook de formulario e mostra feedbacks.
- useLoginForm
  - Tipo: hook de formulario
  - Caminho: src/hooks/useLoginForm.js
  - Responsavel por: estado de username/senha, submit, recuperacao de senha, mensagens de erro/sucesso.
- ResetPasswordPage
  - Tipo: componente de pagina React
  - Caminho: src/pages/ResetPasswordPage.jsx
  - Responsavel por: UI de redefinicao de senha consumindo hook dedicado.
- useResetPassword
  - Tipo: hook de reset
  - Caminho: src/hooks/useResetPassword.js
  - Responsavel por: restaurar sessao do link, validar senha/confirmacao, enviar update e redirecionar.

Constantes e configuracoes
--------------------------
- LOCAL_AUTH (AuthContext)
  - Tipo: configuracao de modo local
  - Caminho: src/context/AuthContext.jsx
  - Uso: credenciais padrao em modo offline.

Funcoes utilitarias relacionadas
--------------------------------
- logError
  - Tipo: logger de erro
  - Caminho: src/services/errorLogService.js
  - Responsavel por: registrar falhas de login/recovery/reset em app_errors.

Servicos e integracoes externas
-------------------------------
- authService (sendPasswordRecovery, updatePassword, restoreResetSession)
  - Tipo: servico de Auth
  - Caminho: src/services/authService.js
  - Responsavel por: enviar email de recuperacao, atualizar senha e restaurar sessao via Supabase.
- AuthContext
  - Tipo: contexto de autenticacao
  - Caminho: src/context/AuthContext.jsx
  - Responsavel por: login (Supabase ou modo local), logout, recoverPassword, persistencia de sessao.
