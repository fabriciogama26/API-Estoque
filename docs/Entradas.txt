Tela: Entradas
==============

Visao geral
-----------
- Registra novas entradas de materiais no estoque.
- Exibe historico paginado das movimentacoes de entrada.
- Reutiliza catalogos de materiais para validar registros e calcular valores totais (quantidade × valor unitario).

Arquitetura
-----------
- Contexto:
  - `EntradasProvider` (`EntradasContext`) expõe o estado e as acoes do hook `useEntradasController`.
- Hook `useEntradasController`:
  - Centraliza estado do formulario, filtros, lista e paginacao.
  - Implementa handlers de submit, update, load, autocomplete e historico.
  - Faz integracao com logs via `useErrorLogger('entradas')`.
- Utils:
  - `entradasUtils` cuida de datas, normalizacao de campos, resumo do material e montagem de queries.
- Servicos:
  - `entradasService` concentra:
    - `list`, `create`, `update`, `history` de entradas.
    - Busca/listagem de materiais e centros de estoque/custo.
- Erros:
  - `useErrorLogger('entradas')` registra falhas de carga, submit, filtros, historico e erros de busca de materiais.

Cadastro
--------
- Campos obrigatorios:
  - Material (selecionado via autocomplete ou lista).
  - Quantidade (minimo 1, valor numerico).
  - Centro de estoque/servico (ou equivalente).
  - Data da entrada.
- Payload:
  - Inclui `usuarioResponsavel` (usuario autenticado).
  - Calcula valor total quando `valorUnitario` estiver disponivel.
- Comportamento:
  - Ao concluir cadastro com sucesso, limpa o formulario e, quando aplicavel, limpa a selecao/autocomplete.
  - Ao iniciar edicao de uma entrada, a pagina rola para o topo e exibe o botao "Cancelar alteracao" ao lado do salvar.
  - Erros de validacao sao exibidos em area de feedback acima dos botoes.

Filtros, auto-complete e listagem
---------------------------------
- Filtros:
  - Termo livre (material, fabricante, usuario).
  - Registrado por (usuario).
  - Centro de estoque/custo.
  - Faixa de datas.
  - "Aplicar" chama `load(filters)` com os filtros atuais.
  - "Limpar" restaura filtros padrao e recarrega a lista.
- Auto-complete de materiais:
  - Dispara busca apos um minimo de caracteres (`MATERIAL_SEARCH_MIN_CHARS`).
  - Usa debounce (`MATERIAL_SEARCH_DEBOUNCE_MS`) para nao sobrecarregar a API.
  - Tenta usar `api.materiais.search`; se nao existir, aplica fallback local sobre `api.materiais.list`.
  - Limita a quantidade de resultados retornados por consulta.
- Historico:
  - Usa `TablePagination` com `TABLE_PAGE_SIZE` para paginar.
  - Cada linha exibe:
    - Material, quantidade, centro de estoque/custo.
    - Valor unitario e valor total (quando disponivel).
    - Usuario responsavel e data da entrada.
  - Se a API nao retornar centros de estoque, o hook deriva opcoes a partir dos registros ja carregados.
- Botoes:
  - "Atualizar" refaz a consulta com os filtros atuais.
  - "Cancelar alteracao" sai do modo de edicao e reseta formulario/buscas quando um registro esta sendo editado.
  - Quando nao ha registros no filtro/periodo, exibe mensagem neutra em vez de tabela vazia quebrada.

Boas praticas
-------------
- Manter catalogo de materiais com fabricante e valor unitario sempre preenchidos para garantir historico financeiro consistente.
- Em modo local, `localApi.entradas.*` deve replicar campos como `materialId`, `dataEntrada`, `quantidade`, `centroCusto`, `usuarioResponsavel`.
- Utilizar filtros de data para recortes especificos antes de gerar relatorios externos.

Atualizacao 2025-12
-------------------
- Pagina modularizada: agora apenas orquestra `EntradasProvider` e componentes visuais.
- Logica de busca, filtros, historico e autocomplete extraida para hook + utils + services.
- Erros da tela registrados no Supabase (ou sistema equivalente) via `useErrorLogger('entradas')`.

===========================================
Mapa de Codigo (funcoes, hooks e constantes)
===========================================

Funcoes principais
------------------
- EntradasPage
  - Tipo: componente de pagina React
  - Caminho: src/pages/EntradasPage.jsx
  - Responsavel por: orquestrar formulario, filtros e tabela de entradas via contexto/controller.
- useEntradasController
  - Tipo: hook/controller
  - Caminho: src/hooks/useEntradasController.js
  - Responsavel por: estado de formulario, filtros, tabela, paginacao, submit/editar/cancelar e historico.
- EntradasContext (quando usado)
  - Tipo: contexto
  - Caminho: src/context/EntradasContext.jsx
  - Responsavel por: compartilhar estado/handlers do controller com os componentes.
- MateriaisForm/Filters/Table/History (variacoes para entradas)
  - Tipo: componentes de UI
  - Caminho: src/components/Entradas/*
  - Responsavel por: UI de filtros, form, tabela e historico consumindo o controller.

Constantes e configuracoes
--------------------------
- Defaults de formulario/filtro/historico
  - Tipo: configuracoes
  - Caminho: src/config/EntradasConfig.js (ou constantes no controller)
  - Uso: estados iniciais de formulario, filtros e modal de historico.

Funcoes utilitarias relacionadas
--------------------------------
- filterEntradas, build payloads, formatadores
  - Tipo: utilitarios/regras
  - Caminho: src/utils/entradasUtils.js e src/rules/EntradasRules.js
  - Responsavel por: montar payloads, filtrar lista, formatar valores/datas e validar campos.

Servicos e integracoes externas
-------------------------------
- entradasService
  - Tipo: servico de API
  - Caminho: src/services/entradasService.js
  - Responsavel por: listar/criar/atualizar/cancelar entradas (Supabase ou modo local via dataClient).

Ajuda contextual
----------------
- Botao 'Ajuda' no cabecalho abre modal com passos e notas desta pagina.
- Conteudo vem de src/help/helpContent.json (chave 'entradas'); edite ali para ajustar titulos/steps/notes.
- Para imagens, salve em public/help/entradas/ e aponte no campo 'media' do passo (ex.: /help/entradas/exemplo.webp).

