Tela: Cadastro de Acidentes
===========================

Visao geral
-----------
- Registrar, editar e consultar acidentes de trabalho vinculados a pessoas cadastradas.
- Usa catalogos de agentes, tipos, lesoes e partes lesionadas; mantem historico das alteracoes.
- Filtros: termo livre, tipo, centro de servico, agente.

Arquitetura (modular)
---------------------
- Hooks: `useAcidentes`, `useAcidenteForm`, `useAcidenteFiltro`, `usePessoas`, `useAgentes`, `useLocais`, `usePartes` isolam dados/estado.
- Contexto opcional: `AcidentesContext` pode expor acidentes, filtros e actions (reload, setFilters) para componentes de UI.
- Servi√ßos: `acidentesService`/`pessoasService` concentram chamadas Supabase/local; utils em `src/utils/acidentesUtils.js` (normalizacao, parse, nomes de agentes).
- Erros: usar `useErrorLogger('acidentes')` para registrar falhas de load, submit, filtros e historico na tabela `app_errors`.

Fluxos principais
-----------------
1) Cadastro/edicao
   - Seleciona matricula existente; campos obrigatorios: matricula, data, dias perdidos/debitados, HHT, centro de servico, local, agente(s), tipo(s), lesao(oes), parte(s) lesionada(s).
   - Campos auxiliares: CAT, observacao, CID, flags de lancamento (eSOCIAL/SESMT).
   - Botao alterna entre *Registrar acidente* e *Salvar alteracoes*; *Cancelar edicao* reseta estado.
2) Multiselecoes (agente/tipo/lesoes/partes)
   - Select popula opcoes; **Adicionar** move o valor para chips removiveis. Bloqueia salvar sem ao menos um item em cada categoria obrigatoria.
3) Historico
   - Botao de relogio abre `AcidentesHistoryModal`; busca via `acidentesService.getAcidenteHistory(id)`. Estado controla loading/erro por modal.
4) Filtros
   - Barra superior controla `filters`; *Aplicar* usa `filterAcidentes` (utils); *Limpar* restaura defaults e reload.

Carregamento de dados
---------------------
- Pessoas, centros/locais, agentes, tipos, lesoes e partes carregam em paralelo; cada catalogo trata erro isoladamente.
- Lista principal `useAcidentes` atualiza apos salvar/editar ou limpar filtros.

Regras e validacoes
-------------------
- `validateAcidenteForm`, `createAcidentePayload`, `updateAcidentePayload` (rules/utils) garantem payload coerente.
- Mantem consistencia entre chips e campos derivados para compatibilidade com tabelas antigas.

Boas praticas
-------------
- Publique catalogos (agentes, tipos, lesoes, partes) antes de abrir a tela.
- Prefira matricula como chave em importacoes; nome/cargo sao derivados.
- Use o historico para auditar ajustes feitos manualmente ou via Supabase.

Atualizacao 2025-12
-------------------
- Tela modularizada em hooks/services/utils; UI dividida em componentes (`AcidentesForm`, `AcidentesFilters`, `AcidentesTable`, `AcidentesHistoryModal`).
- Logs de erro direcionados a `app_errors` via `useErrorLogger('acidentes')`; filtros/loads nao devem causar flicker.
