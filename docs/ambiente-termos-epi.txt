Ambiente de geração do Termo de EPI
===================================

Visão geral
-----------
O fluxo atual não depende mais de Puppeteer ou funções serverless para gerar PDF. Todo o processo ocorre no navegador:
- O contexto do termo é obtido diretamente pelo `dataClient` (Supabase ou dados locais).
- O HTML é renderizado com `buildEpiTermHtml` e convertido para PDF no cliente usando `html2pdf.js`.

Passos para utilizar
--------------------
1. Configure o `.env.local` do frontend com as variáveis necessárias. Exemplo:
   ```
   VITE_DATA_MODE=remote            # ou "local" para usar o armazenamento do navegador
   VITE_SUPABASE_URL=...
   VITE_SUPABASE_ANON_KEY=...
   ```
2. Execute o frontend normalmente:
   ```bash
   npm run dev
   ```
3. Acesse `http://localhost:5173`, autentique-se e navegue até **Termos > Termo de EPI**.

Notas sobre modos de dados
--------------------------
- **Modo Supabase:** `src/services/api.js` consulta `pessoas` e `saidas` direto do banco e devolve JSON com `origem: 'remoto'`.
- **Modo local:** `src/services/localApi.js` monta o contexto com os dados do `localStorage` e marca `origem: 'local'`.
- O badge na tela indica o modo ativo para facilitar testes.

Customização e assets
---------------------
- Logos, razão social e contato usados no documento são definidos pelas variáveis `VITE_TERMO_EPI_EMPRESA_*`.
- Ajustes visuais devem ser feitos em `shared/documents/epiTermTemplate.js` (preview e PDF usam o mesmo template).

Limpeza de dados locais
-----------------------
- Para reiniciar o modo local, remova a chave `api-estoque-local-data-v1` do `localStorage`.
- Se necessário, limpe `api-estoque-auth` para forçar novo login com as credenciais definidas em `.env.local`.

Quando usar backend serverless
------------------------------
- As funções em `api/` permanecem opcionais (ex.: para integrar com sistemas externos ou armazenar PDFs). O fluxo padrão da tela não requer essas funções.
- Caso ative uma rota serverless para gerar PDF em backend, reutilize o contexto retornado pelo `dataClient` para manter consistência.
