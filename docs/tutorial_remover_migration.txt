# Tutorial: Como Remover uma Migration no Supabase (Exemplo com 0029)

## 1. Situação
Você executou `supabase db pull` e recebeu o erro:

```
The remote database's migration history does not match local files...
```

e o Supabase sugeriu algo como:
```
supabase migration repair --status reverted 0029
```

Isso indica que a migration **0029** está marcada como aplicada no banco remoto, mas não existe/localmente está divergente.

---

## 2. Objetivo
Remover (reverter) a migration `0029` do histórico e sincronizar o repositório.

---

## 3. Passos para corrigir

### ✅ Passo 1 — Reverter a migration no Supabase
Execute:

```bash
supabase migration repair --status reverted 0029
```

> O comando apenas ajusta o histórico; não desfaz o SQL executado.

### ✅ Passo 2 — Apagar o arquivo local da migration
Remova manualmente o arquivo correspondente:

```
supabase/migrations/0029_create_material_view_tables.sql
```

### ✅ Passo 3 — Verificar o status

```bash
supabase db status
```

Confirme que a migration 0029 não aparece mais como aplicada.

### ✅ Passo 4 — Sincronizar o schema novamente

```bash
supabase db pull
```

Atualiza o diretório `supabase/` com o estado atual do banco.【F:supabase/README.md†L57-L102】

---

## 4. (Opcional) Remover o que a migration criou
Se desejar desfazer objetos criados pela migration (tabelas, views, policies), rode o SQL inverso manualmente:

```sql
DROP VIEW IF EXISTS materiais_view;
DROP TABLE IF EXISTS material_view_aux;
```

---

## 5. Resultado final
- Migration 0029 revertida no histórico remoto.
- Arquivo local removido.
- Repositório sincronizado com o estado atual.
- `supabase db pull` sem conflitos.

---

## 6. Dica extra
Para criar uma nova migration corrigida:

```bash
supabase migration new create_material_view_tables_v2
supabase db push
```

Os comandos mantêm o histórico alinhado e reaplicam o SQL atualizado.【F:supabase/README.md†L57-L102】


Atualizacao 2025-11
--------------------
- Acrescentei exemplo mencionando que, caso a migracao introduza campos como `fabricante_nome`, revoga-la exige rodar novamente os scripts usados pelos graficos.
- Tambem registrei a necessidade de revisar seeds apos remover migracoes que impactem os filtros clicaveis.
