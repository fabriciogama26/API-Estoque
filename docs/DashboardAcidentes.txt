Tela: Dashboard de Acidentes
============================

Visão geral
-----------
- Reúne indicadores de SST (taxa de frequência/gravidade, totais e distribuições) utilizando a mesma UI para Supabase e modo local.
- Quando executado em modo Supabase, consulta a view `vw_indicadores_acidentes` (ou estrutura equivalente) e adapta o formato recebido.
- Em modo local, usa `localApi.acidentes.dashboard` para calcular agregados a partir dos registros armazenados no navegador.

Fluxo de dados
--------------
1. `DashboardAcidentes` inicializa os filtros com o ano corrente e chama `load(initialFilters())` no `useEffect` inicial.
2. A função `load`:
   - Valida se o Supabase está configurado (modo remoto) e exibe erro amigável caso contrário.
   - No modo local: chama `dataClient.acidentes.dashboard(params)` e extrai `resumo`, séries e listas de opções.
   - No modo remoto: monta uma consulta sobre `vw_indicadores_acidentes` usando `supabase.from(...).maybeSingle()`, filtrando por ano e unidade quando informados.
3. A resposta é normalizada (`normalizeResumo`, `normalizeArray`) para alimentar os componentes `DashboardCards`, `ChartTendencia`, `ChartTipos`, `ChartPartesLesionadas`, `ChartCargos` e `ChartAgentes`.

Filtros suportados
------------------
- Ano (campo numérico tratado como string) e unidade (quando a view disponibiliza a coluna).
- Período inicial/final (`type="month"`), centro de serviço, tipo, lesão, parte lesionada, agente e cargo.
- Os selects adicionais (centro/tipo/lesão/parte/agente/cargo) são populados somente no modo local, pois a view remota fornece dados consolidados já filtrados por ano/unidade.

Indicadores exibidos
--------------------
- Cartões com total de acidentes, taxa de frequência (TF), taxa de gravidade (TG) e horas homem trabalhadas.
- Série temporal mensal de acidentes (`ChartTendencia`).
- Distribuições por tipo, parte lesionada, cargo e agente de acidente.
- Cada gráfico mostra mensagens de vazio quando o array correspondente está sem valores > 0.

Estados e mensagens
-------------------
- `isLoading`: exibe feedback de carregamento enquanto aguarda a consulta.
- `error`: mensagem global quando a consulta falha (inclui validação de configuração do Supabase).
- Ao limpar filtros (`handleReset`) o estado volta ao padrão e recarrega os dados.

Componentes e utilitários relacionados
--------------------------------------
- `src/pages/DashboardAcidentes.jsx`
- `src/components/DashboardCards.jsx`
- `src/components/charts/ChartTendencia.jsx`
- `src/components/charts/ChartTipos.jsx`
- `src/components/charts/ChartPartesLesionadas.jsx`
- `src/components/charts/ChartCargos.jsx`
- `src/components/charts/ChartAgentes.jsx`
- `src/components/FiltrosDashboard.jsx`
- `src/utils/indicadores.js` (helper `resolveIndicadorValor`)
- `src/lib/acidentesDashboard.js` (cálculos do modo local)

Requisitos de dados no Supabase
-------------------------------
- View `vw_indicadores_acidentes` (ou similar) deve expor, no mínimo, os campos utilizados na normalização: `resumo`, `tendencia`, `tipos`, `partes_lesionadas`, `cargos`, `agentes`.
- As tabelas de apoio (`acidente_agentes`, `acidente_partes`, `acidente_lesoes`, `acidente_tipos`) alimentam o modo local e o formulário de cadastro de acidentes.
- HHT, dias perdidos e debitados precisam estar preenchidos nos registros para que TF/TG retornem valores consistentes.
