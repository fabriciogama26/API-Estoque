Tela: Estoque Atual
===================

Visão geral
-----------
- Consolida o saldo de cada material combinando entradas e saídas a partir do `dataClient`.
- Permite ajustar o estoque mínimo diretamente na tabela com feedback imediato.
- Opera com os mesmos componentes no modo Supabase ou no modo local (dados em `localStorage`).

Fluxo de dados
--------------
1. `EstoquePage` monta filtros (`periodoInicio`, `periodoFim`) e chama `dataClient.estoque.current(params)` ao carregar ou enviar o formulário.
2. O client remoto (`src/services/api.js`) carrega materiais, entradas e saídas do Supabase e delega o cálculo para `montarEstoqueAtual` (`src/lib/estoque.js`).
3. O client local (`src/services/localApi.js`) reutiliza o mesmo helper com os dados armazenados em `localStorage`.
4. Ao salvar o estoque mínimo de um item a página chama `dataClient.materiais.update(materialId, { estoqueMinimo, usuarioResponsavel })` e recarrega a lista.

Filtros e ordenação
-------------------
- `periodoInicio`/`periodoFim`: inputs `type="month"` que limitam os movimentos considerados nos cálculos.
- `termo`: filtragem em memória por nome, fabricante ou centro de custo.
- `centroCusto`: lista derivada dos itens carregados; o filtro ocorre apenas no cliente.
- A tabela é ordenada pela quantidade disponível em ordem decrescente (`montarEstoqueAtual` já entrega os dados ordenados).

Campos exibidos
---------------
- Nome do material, fabricante e centros de custo associados.
- Quantidade atual, estoque mínimo, déficit e valor estimado para reposição.
- Datas da última entrada/saída relevantes para o item.
- Botão de salvar por linha que permanece desabilitado enquanto a atualização estiver em andamento (`savingMinStock`).

Regras de validação
-------------------
- O formulário de filtros impede submissão com datas inválidas (os inputs `month` garantem formato `yyyy-mm`).
- Na edição inline:
  - O valor precisa ser numérico inteiro ≥ 0.
  - Se o valor não mudar, a requisição não é enviada.
  - Erros retornados pelo `dataClient` são exibidos no topo da página (`setError`).
- O usuário responsável é resolvido pelo `AuthContext` (`user?.name || user?.username || 'sistema'`).

Estados de interface
--------------------
- `isLoading`: exibe mensagem "Carregando estoque..." e desabilita as ações.
- `error`: mostra mensagem de falha quando o carregamento ou a gravação não são concluídos.
- `savingMinStock[materialId]`: ativa o loader no botão de salvar para cada linha.
- `minStockErrors[materialId]`: exibe feedback de validação logo abaixo do campo editável.

Componentes relacionados
------------------------
- `src/pages/EstoquePage.jsx`
- `src/lib/estoque.js` (cálculo de saldos, alertas e resumo)
- `src/services/api.js` e `src/services/localApi.js` (fonte de dados)
- `src/styles/EstoquePage.css` (layout da tabela e do formulário)

Integração com outras áreas
---------------------------
- Os dados alimentam o dashboard principal via `dataClient.estoque.dashboard` (ver [`docs/Dashboard.txt`](Dashboard.txt)).
- Alertas de estoque mínimo são reutilizados em cards do dashboard para destacar materiais críticos.
