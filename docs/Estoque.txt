Tela: Estoque Atual
===================

Visao geral
-----------
- Consolida saldo por material, lista alertas de estoque minimo e permite ajuste inline do minimo.
- Carrega via `api.estoque.current({ periodoInicio, periodoFim })`, retornando `itens` e `alertas`.
- Valores monetarios em BRL; quantidades com `Intl.NumberFormat`.

Arquitetura (modular)
---------------------
- Hook/Contexto: `useEstoque` + `EstoqueContext` (para tela Estoque) cuidam de dados, filtros e atualizacoes; caches evitam recargas desnecessarias.
- Filtros isolados em `useEstoqueFiltro.js`; regras em `src/rules/estoqueRules.js` (minimo, validacao).
- Servicos: `dataClient.estoque.current` para saldo/alertas; `materiais.update` para salvar minimo.
- Logs de erro: use `useErrorLogger('estoque')` para registrar falhas de carga ou update (integra com `app_errors`).

Filtros
-------
- Periodo inicial/final (mes/ano), termo de busca (nome/fabricante/centro), centro de estoque.
- Botoes: **Aplicar filtros** (submete), **Limpar filtros** (restaura defaults e recarrega).

Alertas
-------
- Cards mostram badge, quantidade atual, minimo, deficit e valor estimado de reposicao.
- Apenas itens filtrados entram nos alertas; vazio exibe mensagem neutra.

Resumo geral
------------
- Total em estoque (valor), total de itens, valor de reposicao (soma do deficit) e data da ultima movimentacao.
- Calculados via `useMemo` sobre itens filtrados.

Lista de itens
--------------
- Cada cartao: fabricante, quantidade, valor unitario/total, validade (dias), CA, centros de custo e ultima atualizacao formatada.
- Campo **Estoque minimo** editavel inline; salva via `api.materiais.update` com `estoqueMinimo` e `usuarioResponsavel`, depois recarrega dados.
- Erros por item exibem feedback; botoes desabilitam enquanto salva.

Boas praticas
-------------
- Configure politicas no Supabase para permitir update de `estoque_minimo` em `materiais` por usuarios autenticados.
- No modo local, mantenha `localApi.estoque.current` alinhado com estrutura esperada (`alertas` + `itens`).
- Use filtros de periodo para auditar movimentacoes especificas antes de relatorios externos.

Atualizacao 2025-12
-------------------
- Refatorada para hook/context com carregamento silencioso e sem flicker no botao de filtro; caches de chave evitam load repetido.
- Integrou `useErrorLogger` na tela de estoque para registrar falhas.
