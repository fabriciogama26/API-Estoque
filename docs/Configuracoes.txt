Tela: Configuracoes
===================

Visao geral
-----------
- Pagina React: src/pages/Configuracoes.jsx.
- Secoes exibidas: gerenciamento de credencial/paginas/status de titulares/dependentes e reset de senha (admin/master).
- Em modo local, a UI mostra apenas avisos (sem Supabase).

Componentes e funcoes
---------------------
- ConfiguracoesPage: monta header + PermissionsSection + AdminResetPasswordSection.
- PermissionsSection:
  - Busca titulares em app_users e dependentes em app_users_dependentes via autocomplete; filtra credenciais por nivel (level em app_credentials_catalog). Master enxerga tudo; demais so veem niveis <= ao seu (master nao aparece para admin).
  - Permite alterar credential (FK UUID para app_credentials_catalog), page_permissions e status (ativo/inativo) de titulares ou dependentes.
  - Salva em app_users ou app_users_dependentes conforme o tipo e registra historico em app_users_credential_history (action update) para ambos.
  - Historico grava com target_auth_user_id (id do login, titular ou dependente) e, quando dependente, inclui owner_app_user_id e target_dependent_id. user_id segue apontando para o titular (FK app_users).
  - Chama RPC sync_user_ban_with_status para alinhar auth.users.banned_until (bloqueio de login) ao status ativo/inativo.
  - Modal CredentialsHistoryModal lista historico de credencial/paginas (acao update/password_reset) baseado no catalogo.
- AdminResetPasswordSection:
  - Autocomplete de usuario/dependente (app_users + app_users_dependentes) e envio de reset via supabase.auth.resetPasswordForEmail.
  - Registra historico (action password_reset) para o alvo escolhido.
- syncAuthUserBan(userId, isActive): helper no front que executa RPC sync_user_ban_with_status (Supabase) para manter banimento do Auth sincronizado com app_users. Falhas sao apenas logadas para nao travar a tela.

Fluxos principais
-----------------
- Edicao de permissoes:
  - Buscar usuario/dependente -> escolher credencial (limitada ao seu nivel) -> alternar paginas -> alternar status (Ativo/Inativo) -> Salvar credencial.
  - Em caso de erro, feedback tipo error; sucesso mostra success.
  - Dependente: credencial/paginas sao calculadas a partir do proprio dependente (nao do titular) no PermissionsContext.
- Historico:
  - Botao de relogio abre modal; lista acoes (update/password_reset) com antes/depois de credencial, paginas e status.
  - Consulta considera target_auth_user_id (id do login) e user_id para trazer eventos tanto de titulares quanto de dependentes.
- Reset de senha (admin/master):
  - Buscar usuario/dependente com email -> Enviar reset de senha (indisponivel no modo local).
  - Registra historico de password_reset.

Integracao com Supabase
-----------------------
- Leitura/escrita: tabelas app_users, app_users_dependentes, app_users_credential_history; catalogo em app_credentials_catalog com coluna level (hierarquia).
- Policies recomendadas: leitura/edicao permitidas somente quando level do alvo <= level do usuario logado; service_role liberado para tudo.
- RPC exigida: sync_user_ban_with_status(p_user_id uuid, p_active boolean) com SECURITY DEFINER e grants para anon/authenticated. Atualiza auth.users.banned_until para bloquear ou liberar login conforme ativo/inativo.
- Em modo local ou sem Supabase, a tela usa apenas o usuario atual como fallback e nao grava nada remoto.

Notas de UX
-----------
- Busca autocomplete substitui dropdown; retorna titulares e dependentes pelo id do auth; filtra opcoes de credencial por level.
- Master aparece somente quando o usuario logado e master; admins nao veem/alteram master.
- Status toggles usam texto Ativo/Inativo e feedback textual.
- Ajuda contextual: HelpButton top-right, conteudo na chave "configuracoes" de src/help/helpContent.json; assets em public/help/configuracoes/.
