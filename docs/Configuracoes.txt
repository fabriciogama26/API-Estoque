Tela: Configuracoes
===================

Visao geral
-----------
- Pagina React: src/pages/Configuracoes.jsx.
- Secoes exibidas: gerenciamento de credencial/permissoes/status (apenas master/admin) e reset de senha (apenas master/admin).
- Em modo local, a UI mostra apenas avisos (sem Supabase).

Componentes e funcoes
---------------------
- ConfiguracoesPage: monta header + PermissionsSection + AdminResetPasswordSection.
- PermissionsSection:
  - Busca titulares/dependentes apenas em `app_users` (parent_user_id null = titular; nao usa mais app_users_dependentes). Master enxerga todos; admin so ve ele e seus dependentes.
  - Permite definir role (master/admin/operador/estagiario/visitante), toggles de grupos de permissao e status ativo/inativo.
  - Salva em `user_roles`, `user_permission_overrides` e `app_users.ativo`; chama RPC `sync_user_ban_with_status` para alinhar ban no Auth.
  - Historico: insere em `app_users_credential_history` com `before_pages` (baseline carregado) e `after_pages` (estado atual), `changed_by(_username)` e `user_username` (alvo). Modal lista antes/depois, quem alterou e alvo.
- AdminResetPasswordSection:
  - Autocomplete em `app_users` e envio de reset via supabase.auth.resetPasswordForEmail.
  - Registra historico (action password_reset) para o alvo escolhido.
- syncAuthUserBan(userId, isActive): helper no front que executa RPC sync_user_ban_with_status (Supabase) para manter banimento do Auth sincronizado com app_users. Falhas sao apenas logadas para nao travar a tela.

Fluxos principais
-----------------
- Edicao de permissoes:
  - Buscar usuario/dependente -> escolher role -> alternar grupos de permissao -> alternar status (Ativo/Inativo) -> Salvar credencial.
  - Em caso de erro, feedback tipo error; sucesso mostra success.
  - Dependente: permissoes sao calculadas a partir do proprio dependente (nao do titular) no PermissionsContext.
- Historico:
  - Botao de relogio abre modal; lista acoes (update/password_reset) com antes/depois de permissoes, quem alterou e alvo (`user_username`).
  - Consulta considera target_auth_user_id (id do login) e user_id (owner).
- Reset de senha (admin/master):
  - Buscar usuario/dependente com email -> Enviar reset de senha (indisponivel no modo local).
  - Registra historico de password_reset.

Integracao com Supabase
-----------------------
- Leitura/escrita: tabelas app_users, user_roles, user_permission_overrides, app_users_credential_history.
- Policies recomendadas: leitura/edicao permitidas somente quando level do alvo <= level do usuario logado; service_role liberado para tudo.
- RPC exigida: sync_user_ban_with_status(p_user_id uuid, p_active boolean) com SECURITY DEFINER e grants para anon/authenticated. Atualiza auth.users.banned_until para bloquear ou liberar login conforme ativo/inativo.
- Em modo local ou sem Supabase, a tela usa apenas o usuario atual como fallback e nao grava nada remoto.

Notas de UX
-----------
- Busca autocomplete substitui dropdown; retorna titulares e dependentes pelo id do auth; filtra opcoes de credencial por level.
- Master aparece somente quando o usuario logado e master; admins nao veem/alteram master.
- Status toggles usam texto Ativo/Inativo e feedback textual.
- Ajuda contextual: HelpButton top-right, conteudo na chave "configuracoes" de src/help/helpContent.json; assets em public/help/configuracoes/.
