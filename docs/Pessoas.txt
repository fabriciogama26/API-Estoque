Tela: Cadastro de Pessoas

- Campos com * sao obrigatorios no formulario.
- Data de admissao (dataAdmissao) e obrigatoria.
- Data de demissao (dataDemissao) e opcional; se preenchida, o backend forÃ§a `ativo=false`. Se nula/vazia, o backend forÃ§a `ativo=true` (trigger em `supabase/migrations/20250114_force_inativo_on_demissao.sql`).

Visao geral
-----------
- Cadastro/edicao de colaboradores (funcionarios, terceiros, estagiarios) com vinculo a centro de servico, centro de custo, setor, cargo e tipo de execucao.
- A tela possui filtros e historico de alteracoes.

Arquitetura (modular)
---------------------
- Hooks: usePessoasController (formulario/filtros/tabela), useErrorLogger('pessoas').
- Servicos: pessoasService (listar, historico, resumo) via dataClient (modo local/remoto).
- Erros: log em app_errors via useErrorLogger.

Campos e fluxos
---------------
- Campos principais: matricula, nome, centro_servico_id/centro_custo_id, setor_id, cargo_id, tipo_execucao_id, dataAdmissao, dataDemissao, ativo.
- Historico: timeline com alteracoes (usuario, data, campos modificados).
- Filtros: termo livre, centro de servico, setor, cargo, ativo, cadastrado de/ate; aplicados apenas no frontend (backend jÃ¡ filtra por `account_owner_id`).
- Tabela: paginacao local; a coluna "Registrado por" usa os campos retornados pela view/RPC de pessoas.
- Historico: modal no padrÃ£o Materiais, mostrando campo a campo (inclui Observacao).

Desligamento em massa (novo)
----------------------------
- Existe um botao "Desligamento" na tela de Pessoas que abre um modal para importacao em massa via XLSX.
- A planilha exige matricula e data_demissao (dd/MM/yyyy); ativo sempre fica false.
- Se a pessoa ja estiver inativa, ela aparece na lista de "ja inativos" no retorno.
- O fluxo completo (frontend + Supabase + Edge Functions + Storage) esta documentado em:
  - docs/DesligamentoEmMassa.txt

Boas praticas
-------------
- Usar matricula como chave; manter catalogos de centro/setor/cargo atualizados.
- Conferir pessoas_view/rpc_pessoas_completa apos migrations para garantir aliases usados na UI.
- Duplicidade: preflight `pessoas_preflight_check` (20250114) bloqueia matricula duplicada e alerta nome igual com matricula diferente (modal). Trigger `evitar_duplicidade_pessoa` bloqueia matricula repetida em insert/update respeitando owner e ignorando o proprio id em update.

===========================================
Mapa de Codigo (funcoes, hooks e constantes)
===========================================

Funcoes principais
------------------
- PessoasPage
  - Tipo: componente de pagina React
  - Caminho: src/pages/Pessoas.jsx
  - Responsavel por: orquestrar formulario, filtros, tabela, historico e o modal de desligamento.
  - Detalhes: modal cartao (padrÃ£o Saidas) com todos os campos + status.
  - Cancelar: modal exige observacao; seta ativo=false; historico registra observacao/ativo.

- PessoasDesligamentoModal
  - Tipo: componente de UI (modal)
  - Caminho: src/components/Pessoas/PessoasDesligamentoModal.jsx
  - Responsavel por: selecionar arquivo XLSX, chamar importacao e exibir retorno/erros.

- usePessoasController
  - Tipo: hook/controller
  - Caminho: src/hooks/usePessoasController.js
  - Responsavel por: estado de formulario/filtros, listagem, historico, submit/editar e carregamento de catalogos auxiliares.

Servicos e integracoes
----------------------
- pessoasService
  - Tipo: servico
  - Caminho: src/services/pessoasService.js
  - Responsavel por: expor metodos da API (inclui importacao de desligamento).

- api.pessoas.importDesligamentoPlanilha
  - Tipo: integracao Supabase (Storage + Edge Function)
  - Caminho: src/services/api.js
  - Responsavel por: (1) upload do XLSX para o bucket imports, (2) invoke da Edge Function desligamento-import com { path }.

Ajuda contextual
----------------
- Botao 'Ajuda' no cabecalho abre modal com passos e notas desta pagina.
- Conteudo vem de src/help/helpContent.json (chave 'pessoas').


Atualizacao 2026-01 (UI)
- Modais dedicados: src/components/Pessoas/Modal/PessoaNomeIgualModal.jsx, PessoaDetailsModal.jsx, PessoaCancelModal.jsx.
- Ajuda: src/help/helpPessoas.json (helpContent.json removido).
