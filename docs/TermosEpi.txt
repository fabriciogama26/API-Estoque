Tela: Termo de EPI
==================

Visão geral
-----------
- Gera o termo de responsabilidade de EPI para colaboradores, com pré-visualização em HTML e opção de download em PDF.
- O contexto é buscado via `dataClient.documentos.termoEpiContext` usando matrícula ou nome; o HTML é montado por `buildEpiTermHtml` (template compartilhado).【F:src/pages/TermosEpiPage.jsx†L1-L87】【F:shared/documents/epiTermTemplate.js†L38-L120】

Fluxo do usuário
----------------
1. Preencher matrícula ou nome e clicar em **Gerar termo**.
2. A página exibe mensagens de carregamento/erro conforme resposta. Ao receber o contexto, renderiza resumo (nome, centro de serviço, última entrega) e o documento dentro de `AutoResizeIframe`.
3. O botão **Baixar PDF** chama `downloadTermoEpiPdf`, que envia o HTML normalizado para a função serverless `/termo-epi` (Vercel/Supabase Functions) e faz download do arquivo nomeado automaticamente.【F:src/pages/TermosEpiPage.jsx†L89-L178】【F:src/utils/TermoEpiUtils.js†L1-L94】

Pré-requisitos
--------------
- Variáveis `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` e `VITE_SUPABASE_FUNCTIONS_URL` devem estar configuradas para o PDF (modo remoto).
- Em modo local, apenas a pré-visualização HTML funciona; o download retornará erro se as variáveis estiverem ausentes.
- A função serverless espera o campo `html` no corpo e utiliza a mesma chave `anon` para autenticação.

Personalização do documento
---------------------------
- Metadados da empresa podem ser definidos via `VITE_TERMO_EPI_EMPRESA_*` (nome, documento, endereço, contato, URLs de logos). O template renderiza até duas logos (principal + secundária) e repete dados de contato no cabeçalho.【F:shared/documents/epiTermTemplate.js†L40-L78】【F:shared/documents/epiTermTemplate.js†L96-L140】
- A tabela de entregas mostra as últimas movimentações com campos: data, quantidade, descrição, CA, responsável, data de troca, motivo e assinatura. Linhas vazias completam até 10 registros por padrão.【F:shared/documents/epiTermTemplate.js†L18-L37】【F:shared/documents/epiTermTemplate.js†L122-L188】

Boas práticas
-------------
- Certifique-se de que `termoEpiContext` retorne `colaborador`, `entregas`, `totais` e `empresa` para aproveitar todas as seções do template.
- Ajuste a função serverless para fazer cache do arquivo ou registrar logs de auditoria conforme requisitos de compliance.
- Valide links de logo (`https://...`) para evitar bloqueios por mixed content quando a aplicação estiver sob HTTPS.
