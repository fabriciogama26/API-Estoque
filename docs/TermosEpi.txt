Tela: Termo de EPI
==================

Visão geral
-----------
- Permite localizar um colaborador e gerar o termo de responsabilidade de EPI com preview imediato e download em PDF no próprio navegador.
- Funciona em ambos os modos de dados: consulta direta ao Supabase ou dados locais sem precisar de backend dedicado.

Fluxo principal
---------------
1. Usuário informa matrícula (preferencial) ou nome do colaborador.
2. Ao enviar, `TermosEpiPage` chama `dataClient.documentos.termoEpiContext(query)`.
   - **Modo Supabase:** `src/services/api.js` consulta `pessoas` e `saidas`, monta o contexto com `montarContextoTermoEpi` e inclui metadados da empresa via variáveis `VITE_TERMO_EPI_EMPRESA_*`.
   - **Modo local:** `src/services/localApi.js` reproduz a mesma lógica com os dados do `localStorage`.
3. O HTML é gerado com `buildEpiTermHtml` (`shared/documents/epiTermTemplate.js`) e exibido em um `<iframe>` com ajuste automático de altura (`AutoResizeIframe`).
4. O botão "Baixar PDF" usa `downloadTermoEpiPdf` (`html2pdf.js` no cliente) para converter o HTML renderizado em arquivo.

Estados e mensagens
-------------------
- `preview.isLoading`: exibe "Carregando documento..." e desabilita ações enquanto aguarda o contexto.
- `preview.error`: mostra erros retornados pelo `dataClient` (colaborador não encontrado, nenhuma saída registrada etc.).
- `isDownloading`: feedback enquanto o PDF é gerado.
- Badge de origem indica se os dados vieram do modo local ou do Supabase (`context.origem`).

Campos obrigatórios
-------------------
- Pelo menos um dos campos deve ser informado (matrícula ou nome). Caso contrário, a página exibe mensagem de validação e não chama a API.

Customização
------------
- Logos, razão social e dados da empresa são configurados via `VITE_TERMO_EPI_EMPRESA_*`.
- O template HTML está em `shared/documents/epiTermTemplate.js`; alterações neste arquivo impactam tanto o preview quanto o PDF.

Componentes e utilitários
-------------------------
- `src/pages/TermosEpiPage.jsx`
- `shared/documents/epiTermTemplate.js`
- `src/utils/TermoEpiUtils.js`
- `src/components/AutoResizeIframe.jsx`

Dependências de dados
---------------------
- Requer saídas registradas para o colaborador. Se nenhuma for encontrada, o `dataClient` retorna erro orientando o usuário a registrar entregas.
- Campos adicionais no Supabase (`centroServico`, `tipoExecucao`, `dataAdmissao`) enriquecem o documento, mas o template lida com ausência dos valores.

Recursos relacionados
---------------------
- [`docs/ambiente-termos-epi.txt`](ambiente-termos-epi.txt) descreve configurações do ambiente e dicas para alternar modos.
